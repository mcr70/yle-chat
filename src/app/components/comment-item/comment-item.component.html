<div [ngClass]="{'top-comment-item': level === 0, 'child-comment-item': level > 0}">
    
    <div class="comment-box" [ngClass]="{'special-comment-box': isSpecialComment()}">
        <div class="comment-header"> 
            
            <div>
                <strong>{{ comment.author }}</strong> 
                <span class="author-date"> {{ formatDate(comment.createdAt) }}</span>
            </div>
            
            <div class="like-container">
                <button 
                    *ngIf="isLoggedIn$ | async"
                    (click)="toggleLike()" 
                    [class.liked]="comment.isLiked"
                    class="like-button"
                    title="{{ comment.isLiked ? 'Poista tykkäys' : 'Tykkää kommentista' }}">
                    
                    <span class="thumb-icon">★</span> 
                </button>

                <span class="likes">{{ comment.likes || 0 }}</span>
            </div>
        </div>
        
        <p class="comment-text">{{ comment.content }}</p>
        
        <div class="comment-actions">    
            <button 
                *ngIf="comment.children && comment.children.length > 0"
                (click)="toggleReplies()"
                class="toggle-button">
                {{ comment.isExpanded ? 'Piilota vastaukset ▲' : 'Näytä ' + comment.children.length + ' vastausta ▼' }}
            </button>
            
            <button 
                class="reply-button" 
                (click)="toggleReplyForm()" 
                *ngIf="isLoggedIn$ | async">
                Vastaa ↵
            </button>
        </div>
        
        <div *ngIf="isReplying" class="reply-form-wrapper">
            <textarea [(ngModel)]="replyText" placeholder="Kirjoita vastauksesi tähän..." rows="4"></textarea>
            <div class="reply-controls">
                <button (click)="sendReply()">Lähetä vastaus</button>
                <button (click)="toggleReplyForm()">Peruuta</button>
            </div>
        </div>
        
    </div> 
    
    <ng-container *ngIf="comment.isExpanded">
      <div class="replies-wrapper">
        <app-comment-item 
            *ngFor="let child of comment.children"
            [comment]="child"
            [level]="level + 1"
            [articleId]="articleId"> </app-comment-item>
      </div>  
    </ng-container>

</div>